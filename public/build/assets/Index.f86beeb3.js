import{d as L,u as te,v as ae,r as g,y as b,C as le,n as m,b as s,o as n,e as S,g as l,h as a,F as E,q as se,f,t as d,i as k,k as p,j as $,x as oe,p as v,E as re,H as ne}from"./app.ea05a65f.js";import{_ as ie,u as de}from"./breadcrumbsData.5c06e62c.js";const ue={class:"q-mt-md"},ce={class:"full-width row flex-center text-primary q-gutter-sm"},me={class:"text-red"},pe={class:"row flex-center q-gutter-x-sm no-wrap"},ge={class:"text-primary text-subtitle1"},_e={class:"q-table__title text-primary"},be=L({__name:"UserTable",props:{paginatedData:null,sortingData:null},setup(U){const o=U,x=te(),B=ae(()=>(r.value=!1,o.paginatedData.data.forEach((t,c)=>{u[`${t.id}`]=g(`${t.status}`)}),o.paginatedData.data)),V=g(b().props.value.search),r=g(!1),P=g(!1),u=le({}),A=g(b().props.value.auth.user.role);g(b().props.value.auth.user.status),o.paginatedData.data.forEach((t,c)=>{u[`${t.id}`]=g(`${t.status}`)});const w=g({sortBy:o.sortingData.column,descending:o.sortingData.descending==="true",page:o.paginatedData.current_page,rowsPerPage:o.paginatedData.per_page,rowsNumber:o.paginatedData.total}),N=[{name:"userAvatar",required:!0,label:m("Avatar"),align:"center",sortable:!1,field:"avatar"},{name:"userFirstname",required:!0,label:m("First name"),align:"left",sortable:!0,field:t=>t.first_name},{name:"userLastname",required:!0,label:m("Last name"),align:"left",sortable:!0,field:t=>t.last_name},{name:"userRole",required:!0,label:m("Role"),align:"center",sortable:!1,field:t=>t.roles,style:"width: 10%"},{name:"userStatus",required:!0,label:m("Status"),align:"center",sortable:!0,field:t=>t.status,style:"width: 15%"},{name:"userRegistered",required:!0,label:m("Registered at"),align:"left",sortable:!0,field:t=>t.registered_at},{name:"userLastLoggedin",required:!0,label:m("Last Logged-in"),align:"left",sortable:!0,field:t=>t.last_login},{name:"userPostcount",required:!0,label:m("Posts count"),align:"center",sortable:!0,field:t=>t.posts_count},{name:"userActions",required:!0,label:m("Actions"),align:"center",field:"actions"}],z=t=>{r.value=!0;const{page:c,rowsPerPage:C,sortBy:D,descending:_}=t.pagination,y=t.filter;v.Inertia.get("/admin/users",{per_page:C,page:c,[D]:_?"asc":"desc",column:D,descending:_,search:y}),w.value.page=c,w.value.rowsPerPage=C,w.value.sortBy=D,w.value.descending=_},T=()=>{r.value=!0,P.value=!0,v.Inertia.get("/admin/users")},H=t=>{v.Inertia.get(`/admin/users/${t.id}/edit`)},j=t=>{v.Inertia.get(`/admin/users/${t.id}`)},Q=t=>{v.Inertia.delete(`/admin/users/${t.id}`,{onSuccess:()=>J(),onError:()=>G(),onStart:()=>r.value=!0,onFinish:()=>r.value=!1})},G=()=>{x.notify({type:"negative",message:"Something went wrong with user deletion"})},J=()=>{x.notify({type:"positive",message:"The user have been deleted successfully"})},K=()=>{v.Inertia.get("/admin/users/create")},I=async t=>{await re(),v.Inertia.post("/admin/users/status",{id:t,status:u[t],page:o.paginatedData.current_page,per_page:o.paginatedData.per_page},{onStart:()=>r.value=!0,onFinish:()=>r.value=!1,preserveScroll:!0})};return(t,c)=>{const C=s("q-th"),D=s("q-tr"),_=s("q-icon"),y=s("q-tooltip"),h=s("q-btn"),q=s("q-td"),R=s("q-avatar"),M=s("q-img"),O=s("q-badge"),F=s("q-toggle"),W=s("q-space"),X=s("q-input"),Y=s("q-separator"),Z=s("q-inner-loading"),ee=s("q-table");return n(),S("div",ue,[l(ee,{title:t.$t("Users"),"row-key":e=>e.id,columns:N,rows:k(B),pagination:w.value,"onUpdate:pagination":c[1]||(c[1]=e=>w.value=e),filter:V.value,onRequest:z,loading:r.value,color:"primary",flat:"","binary-state-sort":"","rows-per-page-label":t.$t("Records per page"),"rows-per-page-options":[5,10,15,o.paginatedData.total,0],bordered:""},{header:a(e=>[l(D,{props:e},{default:a(()=>[(n(!0),S(E,null,se(e.cols,i=>(n(),p(C,{key:i.name,props:e,class:"text-primary"},{default:a(()=>[$(d(i.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":a(()=>[f("div",ce,[l(_,{size:"2em",name:"sentiment_dissatisfied",color:"red"}),f("span",me,d(t.$t("No data available")),1)])]),"body-cell-userActions":a(e=>[l(q,{props:e,"auto-width":""},{default:a(()=>[f("div",pe,[e.row.status==="pending"||e.row.roles==="admin"&&e.row.id===k(b)().props.value.auth.user.id||e.row.roles==="super-admin"||k(b)().props.value.auth.user.role==="super-admin"&&e.row.roles==="admin"?(n(),p(h,{key:0,outline:"",color:"accent",icon:"edit",disable:r.value,onClick:i=>H(e.row),"data-test":"edit-button"},{default:a(()=>[l(y,{delay:1e3,anchor:"bottom middle",self:"center middle"},{default:a(()=>[$(d(t.$t("Edit user")),1)]),_:1})]),_:2},1032,["disable","onClick"])):(n(),p(h,{key:1,outline:"",color:"secondary",icon:"visibility",disable:r.value,onClick:i=>j(e.row),"data-test":"view-button"},{default:a(()=>[l(y,{delay:1e3,anchor:"bottom middle",self:"center middle"},{default:a(()=>[$(d(t.$t("View user")),1)]),_:1})]),_:2},1032,["disable","onClick"])),e.row.status==="pending"||k(b)().props.value.auth.user.role==="super-admin"&&e.row.roles==="admin"?(n(),p(h,{key:2,outline:"",color:"red",icon:"delete",disable:r.value,onClick:i=>Q(e.row),"data-test":"delete-button"},{default:a(()=>[l(y,{delay:1e3,anchor:"bottom middle",self:"center middle"},{default:a(()=>[$(d(t.$t("Delete user")),1)]),_:1})]),_:2},1032,["disable","onClick"])):(n(),p(h,{key:3,outline:"",color:"grey",icon:"delete",disable:"","data-test":"delete-button"},{default:a(()=>[l(y,{delay:1e3,anchor:"bottom middle",self:"center middle"},{default:a(()=>[$(d(t.$t("Delete user")),1)]),_:1})]),_:1}))])]),_:2},1032,["props"])]),"body-cell-userAvatar":a(e=>[e.row.avatar?(n(),p(q,{key:1,props:e,"auto-width":""},{default:a(()=>[l(R,{size:"40px"},{default:a(()=>[l(M,{height:"40px",src:e.row.avatar},null,8,["src"])]),_:2},1024)]),_:2},1032,["props"])):(n(),p(q,{key:0,props:e,"auto-width":""},{default:a(()=>[l(R,{size:"40px",color:"orange",class:"text-white"},{default:a(()=>[$(d(e.row.first_name[0]+e.row.last_name[0]),1)]),_:2},1024)]),_:2},1032,["props"]))]),"body-cell-userPostcount":a(e=>[l(q,{props:e,"auto-width":""},{default:a(()=>[f("span",ge,d(e.row.posts_count),1)]),_:2},1032,["props"])]),"body-cell-userRole":a(e=>[l(q,{props:e,"auto-width":""},{default:a(()=>[l(O,{outline:"",class:oe([e.row.roles==="author"?"text-green":e.row.roles==="member"?"text-primary":e.row.roles==="admin"?"text-accent":"text-red"]),label:e.row.roles},null,8,["class","label"])]),_:2},1032,["props"])]),"body-cell-userStatus":a(e=>[l(q,{props:e,"auto-width":""},{default:a(()=>[e.row.status==="pending"?(n(),p(F,{key:0,label:u[`${e.row.id}`],color:"red",class:"text-red","false-value":"pending","true-value":"enabled","onUpdate:modelValue":[i=>I(e.row.id),i=>u[`${e.row.id}`]=i],"keep-color":"",modelValue:u[`${e.row.id}`]},null,8,["label","onUpdate:modelValue","modelValue"])):(n(),p(F,{key:1,label:u[`${e.row.id}`],color:"primary",class:"text-primary","false-value":"disabled","true-value":"enabled","onUpdate:modelValue":[i=>I(e.row.id),i=>u[`${e.row.id}`]=i],"keep-color":"",disable:e.row.roles==="super-admin"&&A.value==="super-admin"||e.row.roles==="admin"&&A.value==="admin",modelValue:u[`${e.row.id}`]},null,8,["label","onUpdate:modelValue","disable","modelValue"]))]),_:2},1032,["props"])]),top:a(()=>[f("div",_e,d(t.$t("Users")),1),l(W),l(X,{clearable:"","clear-icon":"close",dense:"",debounce:"300","label-color":"primary",modelValue:V.value,"onUpdate:modelValue":c[0]||(c[0]=e=>V.value=e),"label-slot":"","data-test":"search-input"},{append:a(()=>[l(_,{name:"search",color:"primary"})]),label:a(()=>[f("div",null,d(t.$t("Search")),1)]),_:1},8,["modelValue"]),l(h,{class:"q-ml-md",color:"primary",outline:"",disable:r.value,onClick:T,"data-test":"refresh-button",loading:P.value,icon:"restart_alt"},null,8,["disable","loading"]),l(Y,{vertical:"",spaced:"",inset:""}),l(h,{color:"green",unelevated:"",onClick:K,"data-test":"add-button",disable:!k(b)().props.value.can.create_user},{default:a(()=>[l(_,{left:"",name:"post_add"}),f("div",null,d(t.$t("Add admin user")),1)]),_:1},8,["disable"])]),loading:a(()=>[l(Z,{showing:"",color:"primary"})]),_:1},8,["title","row-key","rows","pagination","filter","loading","rows-per-page-label","rows-per-page-options"])])}}}),we=L({__name:"Index",props:{model:null},setup(U){const o=U,x=g(de);return(B,V)=>(n(),S(E,null,[l(k(ne),{title:"Blog users"}),l(ie,{data:x.value},null,8,["data"]),l(be,{paginatedData:o.model.users,sortingData:o.model.sorting},null,8,["paginatedData","sortingData"])],64))}});export{we as default};
